{"version":3,"file":"index.js","sources":["../dist-src/helpers/utils.js","../dist-src/hooks/useTorchLight.js"],"sourcesContent":["export const log = (msg, color, {\n  debug\n}) => {\n  if (debug) {\n    console.log(`%c${msg}`, `color:${color};font-weight:bold;`);\n  }\n};\nexport const isFunction = val => typeof val === 'function';","import { useState, useCallback } from 'react';\nimport { log, isFunction } from \"../helpers/utils.js\";\nconst defaultOptions = {\n  debug: false,\n  vibrate: 70\n};\nexport const useTorchLight = (stream, {\n  debug,\n  vibrate,\n  onError,\n  onSuccess\n} = defaultOptions) => {\n  const [on, setOn] = useState(false);\n  const turnOn = useCallback(async () => {\n    try {\n      window.navigator.vibrate([vibrate]);\n\n      if (stream) {\n        const [track] = stream.getTracks();\n\n        if (track instanceof MediaStreamTrack) {\n          try {\n            // ImageCapture is a new specification supported in modern browsers\n            const imageCapture = new ImageCapture(track);\n            const capabilities = await imageCapture.getPhotoCapabilities();\n\n            if (capabilities.fillLightMode.includes('flash')) {\n              await track.applyConstraints({\n                advanced: [{\n                  torch: true\n                }]\n              });\n\n              if (isFunction(onSuccess)) {\n                onSuccess({\n                  track,\n                  on\n                });\n              }\n            }\n          } catch (err) {\n            log(`[UseTorchLight]: error ${err.message}`, 'red', {\n              debug\n            }); // If errored, we can go to fallback forcing to apply the constraints\n\n            try {\n              await track.applyConstraints({\n                advanced: [{\n                  torch: true\n                }]\n              });\n            } catch (err) {\n              log(`[UseTorchLight]: error ${err.message}`, 'red', {\n                debug\n              });\n\n              if (isFunction(onError)) {\n                onError(err);\n              }\n            }\n\n            if (isFunction(onError)) {\n              onError(err);\n            }\n          }\n\n          setOn(true);\n        }\n      }\n    } catch (err) {\n      log(`[UseTorchLight]: error ${err.message}`, 'red', {\n        debug\n      });\n    }\n  }, [stream, vibrate, debug]);\n  const turnOff = useCallback(async () => {\n    window.navigator.vibrate([vibrate]);\n\n    if (stream) {\n      const pc = new RTCPeerConnection(); // Older way for browsers\n\n      if ('applyConstraints' in stream) {\n        try {\n          await (stream === null || stream === void 0 ? void 0 : stream.applyConstraints({\n            advanced: [{\n              torch: false\n            }]\n          }));\n\n          if ('addStream' in pc) {\n            pc === null || pc === void 0 ? void 0 : pc.addStream(stream);\n          }\n\n          if (isFunction(onSuccess)) {\n            onSuccess({\n              stream,\n              on\n            });\n          }\n        } catch (err) {\n          log(`[UseTorchLight]: error ${err.message}`, 'red', {\n            debug\n          });\n\n          if (isFunction(onError)) {\n            onError(err);\n          }\n        } // New way for modern browsers\n\n      } else {\n        const tracks = stream.getTracks();\n\n        for (let track of tracks) {\n          try {\n            await track.applyConstraints({\n              advanced: [{\n                torch: false\n              }]\n            });\n            pc.addTrack(track, stream);\n\n            if (isFunction(onSuccess)) {\n              onSuccess({\n                track,\n                on\n              });\n            }\n          } catch (err) {\n            log(`[UseTorchLight]: error ${err.message}`, 'red', {\n              debug\n            });\n\n            if (isFunction(onError)) {\n              onError(err);\n            }\n          }\n        }\n      }\n\n      setOn(false);\n    }\n  }, [stream, vibrate, debug]);\n  return [on, on ? turnOff : turnOn];\n};"],"names":["log","msg","color","debug","console","isFunction","val","defaultOptions","vibrate","useTorchLight","stream","onError","onSuccess","on","setOn","useState","turnOn","useCallback","window","navigator","track","getTracks","MediaStreamTrack","imageCapture","ImageCapture","capabilities","getPhotoCapabilities","fillLightMode","includes","applyConstraints","advanced","torch","err","message","turnOff","pc","RTCPeerConnection","addStream","tracks","addTrack"],"mappings":"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"}