{"version":3,"file":"index.js","sources":["../dist-src/helpers/utils.js","../dist-src/hooks/useTorchLight.js"],"sourcesContent":["export const log = (msg, color, {\n  debug\n}) => {\n  if (debug) {\n    console.log(`%c${msg}`, `color:${color};font-weight:bold;`);\n  }\n};\nexport const isFunction = val => typeof val === 'function';","import { useState, useCallback } from 'react';\nimport { log, isFunction } from \"../helpers/utils.js\";\nconst defaultOptions = {\n  debug: false,\n  vibrate: 70\n};\nexport const useTorchLight = (stream, {\n  debug,\n  vibrate,\n  onError,\n  onSuccess\n} = defaultOptions) => {\n  const [on, setOn] = useState(false);\n  const turnOn = useCallback(async () => {\n    try {\n      window.navigator.vibrate([vibrate]);\n\n      if (stream) {\n        const [track] = stream.getTracks();\n\n        if (track instanceof MediaStreamTrack) {\n          try {\n            // ImageCapture is a new specification supported in modern browsers\n            const imageCapture = new ImageCapture(track);\n            const capabilities = await imageCapture.getPhotoCapabilities();\n\n            if (capabilities.fillLightMode.includes('flash')) {\n              await track.applyConstraints({\n                advanced: [{\n                  torch: true\n                }]\n              });\n\n              if (isFunction(onSuccess)) {\n                onSuccess({\n                  track,\n                  on\n                });\n              }\n            }\n          } catch (err) {\n            log(`[UseTorchLight]: error ${err.message}`, 'red', {\n              debug\n            }); // If errored, we can go to fallback forcing to apply the constraints\n\n            try {\n              await track.applyConstraints({\n                advanced: [{\n                  torch: true\n                }]\n              });\n            } catch (err) {\n              log(`[UseTorchLight]: error ${err.message}`, 'red', {\n                debug\n              });\n\n              if (isFunction(onError)) {\n                onError(err);\n              }\n            }\n\n            if (isFunction(onError)) {\n              onError(err);\n            }\n          }\n\n          setOn(true);\n        }\n      }\n    } catch (err) {\n      log(`[UseTorchLight]: error ${err.message}`, 'red', {\n        debug\n      });\n    }\n  }, [stream, vibrate, debug]);\n  const turnOff = useCallback(async () => {\n    window.navigator.vibrate([vibrate]);\n\n    if (stream) {\n      const pc = new RTCPeerConnection(); // Older way for browsers\n\n      if ('applyConstraints' in stream) {\n        try {\n          await (stream === null || stream === void 0 ? void 0 : stream.applyConstraints({\n            advanced: [{\n              torch: false\n            }]\n          }));\n\n          if ('addStream' in pc) {\n            pc === null || pc === void 0 ? void 0 : pc.addStream(stream);\n          }\n\n          if (isFunction(onSuccess)) {\n            onSuccess({\n              stream,\n              on\n            });\n          }\n        } catch (err) {\n          log(`[UseTorchLight]: error ${err.message}`, 'red', {\n            debug\n          });\n\n          if (isFunction(onError)) {\n            onError(err);\n          }\n        } // New way for modern browsers\n\n      } else {\n        const tracks = stream.getTracks();\n\n        for (let track of tracks) {\n          try {\n            await track.applyConstraints({\n              advanced: [{\n                torch: false\n              }]\n            });\n            pc.addTrack(track, stream);\n\n            if (isFunction(onSuccess)) {\n              onSuccess({\n                track,\n                on\n              });\n            }\n          } catch (err) {\n            log(`[UseTorchLight]: error ${err.message}`, 'red', {\n              debug\n            });\n\n            if (isFunction(onError)) {\n              onError(err);\n            }\n          }\n        }\n      }\n\n      setOn(false);\n    }\n  }, [stream, vibrate, debug]);\n  return [on, on ? turnOff : turnOn];\n};"],"names":[],"mappings":"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"}